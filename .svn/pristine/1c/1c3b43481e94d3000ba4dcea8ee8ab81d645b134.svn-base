package rpg;

import java.io.OutputStream;
import java.io.PrintStream;
import java.util.Random;
import fi.jyu.mit.ohj2.Mjonot;

/**
 * Rpg hahmo joka osaa mm. itsehuolehtia tunnusNro:sta
 * 
 * @author Ilari Massa
 * @version Feb 20, 2019
 *
 */
public class Hahmo {
    private int tunnusNro;
    private String name = "";
    private int hahmonrotu = 0;
    private int age = 0;
    private String origin = "";
    private String allignment = "";
    private String notes = "";
    
    private int str = 0;
    private int dex = 0;
    private int consti = 0;
    private int luck = 0;
    private int exp = 0;
    private int wis = 0;
    private int cha = 0;
    private int inte = 0;
    private int gold = 0;
    private int lvl = 0;
    
    private static int seuraavaNro = 1;
    
    /**
     * 
     */
    public Hahmo () {
        //
    }
    
    /**
     * @param rid hahmon rotu numero
     */
    public Hahmo (int rid) {
        this.hahmonrotu = rid;
    }
    
    /**
     * Hakee hahmon nimen
     * @return hahmon nimi
     * @example
     * <pre name="test">
     *  Hahmo aku = new Hahmo();
     *  aku.taytaAkuAnkka();
     *  aku.getNimi().equals("Ankka Aku");
     * </pre>
     */
    public String getNimi() {
        return name;
    }
    
    /**
     * Apumetodi, jolla saadaan täytettyä testiarvot jäsenille
     * @param rid rotu joka annetaan henkilölle
     */
    public void taytaAkuAnkka(int rid) {
        name = "Ankka Aku";
        age = 18;
        hahmonrotu  = rid;
        origin = "Ankka linna";
        allignment = "True Neutral";
        notes = "Velkaa Roopelle";
        
        str = 5;
        dex = 5;
        consti = 2;
        luck = 0;
        exp = 12;
        wis = 3;
        cha = 4;
        inte = 2;
        gold = 3;
        lvl = 4;
    }
    
    /**
     * Apumetodi jolla saadaan täytettyä testiarvot jäsenille
     * rid arvotaan jotta kahdella jäsenellä ei olisi samoja tietoja
     */
    public void taytaAkuAnkka() {
        Random rand = new Random();
        int rid  = 0 + rand.nextInt(2);
        taytaAkuAnkka(rid);
    }
    
    
    /**
     * Tulostaa henkilön tiedot
     * @param out tietovirta johon tulostetaan
     */
    public void tulosta(PrintStream out) {
        out.println("Character name and id: " + name + " " + tunnusNro + "\n" + "Race: " + hahmonrotu + "\n" + "Age: " + age + "\n" + "Origin: " + origin 
                + "\n" + "Allignment: " + allignment + "\n" + "Additional information: " + notes  );
        
        out.println( name + "'s stats are: " + "\n" + "Str: " +  + str + "\n" + "Dex: " + dex + "\n" + "Const: " + consti + "\n" + "Luck: " + luck + "\n" +
        "Exp: " + exp + "\n" + "Wis: " + wis + "\n" + "Cha: " + cha + "\n" + "Int: " + inte + "\n" + "Gold: " + gold + "\n" + "Level: " + lvl);
        
    }
    
    /**
     * Tulostetaan henkilön tiedot
     * @param os tietovirta johon tulostetaan
     */
    public void tulosta(OutputStream os) {
        tulosta(new PrintStream(os));
    }
    
    /**
     * Hakee tunnus numeron
     * @return tunnusnumero
     */
    public int getTunnusNro() {
        return tunnusNro;
    }


    /**
     * Asettaa tunnusnumeron ja samalla varmistaa että
     * seuraava numero on aina suurempi kuin tähän mennessä suurin.
     * @param nr asetettava tunnusnumero
     */
    private void setTunnusNro(int nr) {
        tunnusNro = nr;
        if (tunnusNro >= seuraavaNro) seuraavaNro = tunnusNro + 1;
    }
    
    /**
     * Antaa hahmolle rekisterinumeron
     * @return hahmon uusi tunnus numero
     * <prename ="test">
     *  Hahmo aku1 = new Hahmo();
     *  aku1.getTunnusNro() === 0;
     *  aku1.rekisteroi();
     *  Hahmo aku2 = new Hahmo();
     *  aku2.rekisteroi();
     *  int n1 = aku1.getTunnusNro();
     *  int n2 = aku2.getTunnusNro();
     *  n1 === n2-1;
     * </pre>
     */
    public int rekisteroi() {
        tunnusNro = seuraavaNro;
        seuraavaNro++;
        return tunnusNro;
        
    }
    
    /**
     * Palauttaa hahmon tiedot merkkijonona jonka voi tallentaa tiedostoon
     * @return hahmon tolppaeroteltuna merkkijononna
     * @example
     * <pre name="test">
     *  Hahmo hahmo = new Hahmo();
     *  hahmo.parse("2|Ankka Aku|18");
     *  hahmo.toString().startsWith("2|Ankka Aku|18|") === true;
     *  </pre>
     */
    @Override
    public String toString() {
        return "" + 
                getTunnusNro() + "|" +
                name + "|" +
                age + "|" +
                origin + "|" +
                allignment + "|" +
                notes + "|" +
                hahmonrotu + "|" +
                str + "|" +
                dex + "|" +
                consti + "|" +
                inte + "|" +
                wis + "|" +
                cha + "|" +
                luck + "|" +
                gold + "|" +
                exp + "|" +
                lvl;
    }
    
    /**
     * Selvittää hahmon tiedot | erotellusta merkistä
     * Åitää huolen että seuraavaNro on suurempi kuin tuleva tunnusNro.
     * @param rivi josta hahmon tiedot saadaan
     * 
     * @example
     * <pre name="test">
     *  Hahmo hahmo = new Hahmo();
     *  hahmo.parse("   3   | Ankka Aku | 18");
     *  hahmo.getTunnusNro() === 3;
     *  hahmo.toString().startsWith("3|Ankka Aku|18|") === true;
     *  
     *  hahmo.rekisteroi();
     *  int n = hahmo.getTunnusNro();
     *  hahmo.parse(""+(n+20));
     *  hahmo.rekisteroi();
     *  hahmo.getTunnusNro() === n+20+1;
     *  
     *  </pre>
     */
    public void parse(String rivi) {
        StringBuffer sb = new StringBuffer(rivi);
        setTunnusNro(Mjonot.erota(sb, '|', getTunnusNro()));
        name = Mjonot.erota(sb, '|', name);
        age = Mjonot.erota(sb, '|', age);
        origin = Mjonot.erota(sb, '|', origin);
        allignment = Mjonot.erota(sb, '|', allignment);
        notes = Mjonot.erota(sb, '|', notes);
        hahmonrotu = Mjonot.erota(sb, '|', hahmonrotu);
        str = Mjonot.erota(sb, '|', str);
        dex = Mjonot.erota(sb, '|', dex);
        consti = Mjonot.erota(sb, '|', consti);
        inte = Mjonot.erota(sb, '|', inte);
        wis = Mjonot.erota(sb, '|', wis);
        cha = Mjonot.erota(sb, '|', cha);
        luck = Mjonot.erota(sb, '|', luck);
        gold = Mjonot.erota(sb, '|', gold);
        exp = Mjonot.erota(sb, '|', exp);
        lvl = Mjonot.erota(sb, '|', lvl);
    }
    
    @Override
    public boolean equals(Object hahmo) {
        if ( hahmo == null) return false;
        return this.toString().equals(hahmo.toString());  
    }
    
    @Override
    public int hashCode() {
        return tunnusNro;
    }

    /**
     * testi ohjelma hahmolle
     * @param args ei käytössä
     */
    public static void main(String args[]) {
        Hahmo aku = new Hahmo(), aku2 = new Hahmo();
        aku.rekisteroi();
        aku2.rekisteroi();
        
        aku.tulosta(System.out);
        aku.taytaAkuAnkka();
        aku.tulosta(System.out);
        
        aku2.taytaAkuAnkka();
        aku2.tulosta(System.out);

        aku2.taytaAkuAnkka();
        aku2.tulosta(System.out);
        
        Hahmo iines = new Hahmo();
        iines.parse("2|  Iines Ankka|18  |   Narnia  |");
        iines.tulosta(System.out);
        
    }
}